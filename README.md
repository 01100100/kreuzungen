# Kreuzungen üíªüö¥‚Äç‚ôÇÔ∏èüåç

**[https://01100100.github.io/kreuzungen](https://01100100.github.io/kreuzungen)**

![Screenshot](site/img/screenshot.jpg)

Kreuzungen is a web application that allows users to upload a local GPX file or fetch an activity from Strava and visualize which waterways their route has crossed. It provides an interactive map for users to explore their journey in detail, highlighting the rivers and streams they've encountered.

## Features

- Upload `.gpx` files directly from your device.
- Display routes on an interactive map.
- Highlight all the waterways crossed during the tour.
- Integration with Strava to fetch activities.
- Information about each crossed waterway accessible through map interaction.

## Powered By Open Data

The application heavily relies on open data from [OpenStreetMap](https://www.openstreetmap.org/about).

## External Libraries and Resources

Kreuzungen uses several external libraries and resources:

- **maplibre-gl** for rendering interactive maps
- **@turf/turf** for spatial analysis
- **togeojson** for converting GPX data to GeoJSON
- **osmtogeojson** for converting OpenStreetMap data to GeoJSON
- **FontAwesome** for icons
- **jQuery** for DOM manipulation and AJAX requests
- **Strava API** for syncing Strava activities

## Development


### Project Structure

If you want to add custom features, you can edit the following files:

- `site/index.html`: Main application structure and inline styles/scripts.
- `site/js/strava_api.js`: Interactions with the Strava API.
- `site/js/polyline.js`: Utilities for handling polyline encoding and decoding.
- `src/auth.py`: Backend authentication logic.
- `src/config.py`: Configuration settings for the backend.
- `Dockerfile` : Instructions for building a minimal Docker image for the backend.
- `fly.toml` : Configuration for deploying the backend auth service with Fly.io.
- `pyproject.toml` : Metadata and python dependency information for Poetry.
- `poetry.lock` : Lock file generated by Poetry for Python dependencies.
- `requirements.txt` : Python requirements file for backend.

### Frontend

To locally serve the frontend, change into the `site/` directory and start a server on port 8000 using the Python 3 one-liner:

```bash
cd site/
python3 -m http.server 8000
```

The site should now be served on [`http://localhost:8000/`](http://localhost:8000/)

### Backend - auth server

To locally serve the Backend, ensure the python env is setup and run `src/auth.py`:

```bash
# Ensure you set the correct values in the .env file and `poetry install` has been done.
source .env
poetry shell
python3 src/auth.py
```

## Deployment

### Frontend - Github pages

The site is served using github pages. There is a github action in place to serve all content in the `site/` subdir for the `main` branch.

The site gets deployed to [https://01100100.github.io/kreuzungen](https://01100100.github.io/kreuzungen).

### Backend - fly.io

The backend is hosted on fly.io. To update the deployment you can run the commands:

```bash
# Ensure you set the correct values in the .env file
source .env
fly secrets set STRAVA_API_CLIENT_SECRET=$STRAVA_API_CLIENT_SECRET
fly secrets set STRAVA_REDIRECT_URI=$STRAVA_REDIRECT_URI
fly deploy
```
